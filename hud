using Oxide.Core.Plugins;
using Oxide.Game.Rust.Cui;
using UnityEngine;

namespace Oxide.Plugins
{
    [Info("CustomHUD", "YourName", "1.0.0")]
    [Description("Un plugin simple pour afficher un HUD personnalisé dans Rust.")]
    public class CustomHUD : RustPlugin
    {
        // Appelé quand un joueur se connecte au serveur
        void OnPlayerInit(BasePlayer player)
        {
            DrawHUD(player);  // Affiche le HUD
        }

        // Appelé quand un joueur se déconnecte
        void OnPlayerDisconnected(BasePlayer player, string reason)
        {
            DestroyHUD(player);  // Supprime le HUD quand le joueur se déconnecte
        }

        // Fonction pour dessiner le HUD à l'écran du joueur
        private void DrawHUD(BasePlayer player)
        {
            // Crée une interface utilisateur basique avec un rectangle transparent
            var element = new CuiElementContainer();

            // Ajout d'un panneau à l'écran
            var panel = new CuiPanel
            {
                Image = { Color = "0.1 0.1 0.1 0.5" },  // Couleur et transparence du panneau
                RectTransform = { AnchorMin = "0.4 0.9", AnchorMax = "0.6 0.95" },  // Position (centrée en haut de l'écran)
                CursorEnabled = false
            };

            string panelName = element.Add(panel);

            // Ajout de texte dans le panneau
            var label = new CuiLabel
            {
                Text = { Text = "Bienvenue sur le serveur PvE!", FontSize = 20, Align = TextAnchor.MiddleCenter, Color = "1.0 1.0 1.0 1.0" },  // Style du texte
                RectTransform = { AnchorMin = "0.0 0.0", AnchorMax = "1.0 1.0" }  // Position et taille du texte dans le panneau
            };

            element.Add(label, panelName);

            // Envoi de l'interface utilisateur au joueur
            CuiHelper.AddUi(player, element);
        }

        // Fonction pour détruire le HUD lorsqu'un joueur quitte ou si nécessaire
        private void DestroyHUD(BasePlayer player)
        {
            CuiHelper.DestroyUi(player, "CustomHUD");
        }

        // Commande pour recharger manuellement le HUD via la console
        [ChatCommand("hud")]
        private void CommandHud(BasePlayer player, string command, string[] args)
        {
            DestroyHUD(player);  // Supprimer l'ancien HUD
            DrawHUD(player);     // Afficher à nouveau le HUD
        }
    }
}
